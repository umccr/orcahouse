{{
    config(
        materialized='view'
    )
}}

{#

    Create a dedicated database view accreditation_lims

    The selected samples are the manifest list from the following location.
    https://github.com/umccr/research-projects/tree/main/grimmond-lab/wgs-accreditation/data
        clin-list-manifest.csv
        control-list-germline-manifest.csv
        control-list-somatic-manifest.csv
        ptc-list-manifest.csv

#}

with source as (

    select
        *
    from
        {{ ref('lims') }}
    where
        library_id in (
            'L1800223',
            'L1800224',
            'L1900563',
            'L1900564',
            'L1900614',
            'L1900615',
            'L1900618',
            'L1901040',
            'L1901041',
            'L2000055',
            'L2000056',
            'L2000239',
            'L2000240',
            'L2000418',
            'L2000419',
            'L2000449',
            'L2000450',
            'L2000457',
            'L2000458',
            'L2000576',
            'L2000577',
            'L2000673',
            'L2000674',
            'L2000763',
            'L2000802',
            'L2000804',
            'L2000808',
            'L2000809',
            'L2000956',
            'L2000957',
            'L2001005',
            'L2001006',
            'L2100078',
            'L2100079',
            'L2100160',
            'L2100161',
            'L2100191',
            'L2100192',
            'L2100215',
            'L2100216',
            'L2100217',
            'L2100225',
            'L2100226',
            'L2100397',
            'L2100398',
            'L2100410',
            'L2100411',
            'L2100412',
            'L2100417',
            'L2100418',
            'L2100551',
            'L2100552',
            'L2100565',
            'L2100566',
            'L2100659',
            'L2100660',
            'L2100725',
            'L2100726',
            'L2100745',
            'L2100746',
            'L2100779',
            'L2100780',
            'L2100785',
            'L2100786',
            'L2100839',
            'L2100845',
            'L2100914',
            'L2100915',
            'L2100916',
            'L2100917',
            'L2101051',
            'L2101052',
            'L2101053',
            'L2101054',
            'L2101099',
            'L2101100',
            'L2101142',
            'L2101143',
            'L2101192',
            'L2101193',
            'L2101214',
            'L2101215',
            'L2101289',
            'L2101290',
            'L2101291',
            'L2101292',
            'L2101479',
            'L2101480',
            'L2101565',
            'L2101566',
            'L2101575',
            'L2101576',
            'L2101587',
            'L2101588',
            'L2101645',
            'L2101646',
            'L2200073',
            'L2200074',
            'L2200081',
            'L2200082',
            'L2200094',
            'L2200095',
            'L2200104',
            'L2200105',
            'L2200230',
            'L2200243',
            'L2200263',
            'L2200264',
            'L2200347',
            'L2200429',
            'L2200440',
            'L2200441',
            'L2200445',
            'L2200446',
            'L2200459',
            'L2200463',
            'L2200473',
            'L2200474',
            'L2200504',
            'L2200505',
            'L2200510',
            'L2200511',
            'L2200514',
            'L2200515',
            'L2200528',
            'L2200529',
            'L2200690',
            'L2200691',
            'L2200692',
            'L2200693',
            'L2200694',
            'L2200695',
            'L2200698',
            'L2200699',
            'L2200706',
            'L2200707',
            'L2200721',
            'L2200722',
            'L2200723',
            'L2200724',
            'L2200775',
            'L2200776',
            'L2200786',
            'L2200792',
            'L2200820',
            'L2200821',
            'L2200872',
            'L2200873',
            'L2200964',
            'L2200967',
            'L2200982',
            'L2200985',
            'L2201015',
            'L2201016',
            'L2201066',
            'L2201067',
            'L2201068',
            'L2201069',
            'L2201146',
            'L2201166',
            'L2201209',
            'L2201210',
            'L2201211',
            'L2201212',
            'L2201226',
            'L2201227',
            'L2201308',
            'L2201317',
            'L2201334',
            'L2201335',
            'L2201369',
            'L2201370',
            'L2201371',
            'L2201372',
            'L2201373',
            'L2201374',
            'L2201440',
            'L2201441',
            'L2201449',
            'L2201450',
            'L2201515',
            'L2201522',
            'L2201541',
            'L2201542',
            'L2201583',
            'L2201584',
            'L2201589',
            'L2201590',
            'L2201601',
            'L2201602',
            'L2201603',
            'L2201604',
            'L2201607',
            'L2201608',
            'L2201711',
            'L2201712',
            'L2201726',
            'L2201727',
            'L2201734',
            'L2201735',
            'L2201748',
            'L2201749',
            'L2201750',
            'L2201753',
            'L2201754',
            'L2201755',
            'L2300063',
            'L2300064',
            'L2300065',
            'L2300066',
            'L2300067',
            'L2300068',
            'L2300123',
            'L2300124',
            'L2300163',
            'L2300164',
            'L2300262',
            'L2300263',
            'L2300382',
            'L2300383',
            'L2300427',
            'L2300433',
            'L2300500',
            'L2300501',
            'L2300506',
            'L2300514',
            'L2300647',
            'L2300648',
            'L2300660',
            'L2300661',
            'L2300776',
            'L2300777',
            'L2300827',
            'L2300828',
            'L2300834',
            'L2300866',
            'L2300867',
            'L2300874',
            'L2300901',
            'L2300902',
            'L2300985',
            'L2300986',
            'L2301020',
            'L2301021',
            'L2301144',
            'L2301146',
            'L2301197',
            'L2301198',

            'L2000069',
            'L2000965',
            'L2000967',
            'L2300943',
            'L2300944',
            'L2300945',
            'L2300946',
            'L2300947',
            'L2300948',
            'L2300949',
            'L2300950',
            'L2301172',
            'L2301173',
            'L2301174',
            'L2301175',
            'L2301203',
            'L2301204',
            'L2301205',
            'L2301206',
            'L2301216',
            'L2301217',
            'L2301218',
            'L2301219',
            'L2301392',
            'L2301393',
            'L2301394',
            'L2401486',
            'L2401487',
            'L2401488',
            'L2401489',
            'L2401490',
            'L2401546',
            'L2401547',
            'L2401548',
            'L2401549',
            'L2401550',
            'L2401551',
            'L2401603',
            'L2401604',
            'L2401605',
            'L2500057',

            'L2500130',
            'L2500138',
            'L2500163',
            'L2500177',
            'L2500258',
            'L2500273',
            'L2500351',
            'L2500372',
            'L2500429',
            'L2500460',
            'L2500482',
            'L2500498',
            'L2500511',
            'L2500609',
            'L2500644',
            'L2500714',
            'L2500722',
            'L2500779',
            'L2500798',
            'L2500814',
            'L2500841',
            'L2500867',
            'L2500966',
            'L2500982',
            'L2501029',
            'L2501069',
            'L2501087',
            'L2501116'

    )
),

transformed as (

    -- No transformation required yet
    select * from source

),

final as (

    select
        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,
        cast(sequencing_run_date as date) as sequencing_run_date,
        cast(library_id as varchar(255)) as library_id,
        cast(alias_library_id as varchar(255)) as alias_library_id,
        cast(internal_subject_id as varchar(255)) as internal_subject_id,
        cast(external_subject_id as varchar(255)) as external_subject_id,
        cast(sample_id as varchar(255)) as sample_id,
        cast(external_sample_id as varchar(255)) as external_sample_id,
        cast(experiment_id as varchar(255)) as experiment_id,
        cast(project_id as varchar(255)) as project_id,
        cast(owner_id as varchar(255)) as owner_id,
        cast(workflow as varchar(255)) as workflow,
        cast(phenotype as varchar(255)) as phenotype,
        cast(type as varchar(255)) as type,
        cast(assay as varchar(255)) as assay,
        cast(quality as varchar(255)) as quality,
        cast(source as varchar(255)) as source,
        cast(truseq_index as varchar(255)) as truseq_index,
        cast(load_datetime as timestamptz) as load_datetime
    from
        transformed
    order by sequencing_run_date desc nulls last, library_id desc

)

select * from final
